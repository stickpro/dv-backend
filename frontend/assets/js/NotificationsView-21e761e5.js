import{d as b,k as _,_ as v,o as i,c as a,a as s,j as L,t as n,f as y,r as d,e as c,h as m,w as x,i as U,F as h,q as g}from"./flag-icons.min-86ec5348.js";import{U as S}from"./UiSwitcher-bf0903c2.js";import{U as V}from"./UiExpand-e56b18da.js";import{U as w}from"./UiButtonLoading-8a0e711d.js";import{U as B}from"./UiCheckbox-fa9f1ce9.js";import{U as C}from"./UiSkeletonBox-7e5f2b59.js";const I=b({data(){return{enabled:!1,loading:!1}},methods:{start(){this.startTelegramBot()},..._("notifications",["startTelegramBot"])}}),H="/assets/images/telegram-bc83df18.svg",E={class:"relative"},D=s("img",{class:"w-32px",src:H,alt:"telegram"},null,-1);function F(t,e,u,k,N,$){return i(),a("div",E,[s("button",{class:"flex items-center gap-2 rounded-32px button-secondary pr-4",onClick:e[0]||(e[0]=(...l)=>t.start&&t.start(...l))},[D,L(" "+n(t.$t("Subscribe")),1)])])}const R=v(I,[["render",F]]),j=b({components:{UiSwitcher:S,UiExpand:V,TelegramBot:R,UiButtonLoading:w},data(){return{isTgBotSubscribed:!1,targets:[],buttonLoading:!1}},computed:{...y("user",{userInfo:"userInfo"}),...y("notifications",{allNotificationsTargets:"allNotificationsTargets",userNotificationsTargets:"userNotificationsTargets",isNotificationsTargetsLoaded:"isNotificationsTargetsLoaded",notificationsLoadTargetsTrigger:"notificationsLoadTargetsTrigger"}),checked(){return t=>this.targets.reduce((e,u)=>u.value===t?u.checked:e,!1)},notificationsStatus(){return this.checked(1)?"enabled":"disabled"}},watch:{userInfo(){this.setIsTgBotSubscribed()},notificationsLoadTargetsTrigger(){this.setTargets()}},created(){this.loadNotificationsTargets(),this.setTargets(),this.setIsTgBotSubscribed()},methods:{..._("notifications",["loadNotificationsTargets","saveUserNotificationsTargets","enableTelegramNotifications"]),..._("user",["loadUserInfo"]),setIsTgBotSubscribed(){this.isTgBotSubscribed=this.userInfo.telegramNotification==="enabled"},switchHandler(t){this.targets=this.targets.map(e=>({...e,checked:e.value===t?!e.checked:e.checked}))},setTargets(){this.isNotificationsTargetsLoaded&&(this.targets=this.allNotificationsTargets.map(t=>({title:t.slug,value:t.id,checked:!!this.userNotificationsTargets.find(e=>e.id===t.id)})))},async enableTelegramNotificationsHandler(){await this.enableTelegramNotifications({status:this.notificationsStatus})},async saveTargets(){try{this.buttonLoading=!0;const t=this.targets.filter(e=>e.checked).map(e=>e.value);await this.saveUserNotificationsTargets({targets:t}),await this.enableTelegramNotificationsHandler(),await this.loadUserInfo(),this.setIsTgBotSubscribed(),this.buttonLoading=!1,this.$toast.success(this.$t("Notifications targets saved"))}catch{this.buttonLoading=!1}}}}),q={class:"card common-wrapper"},A={class:"text-xl mb-6"},M={class:"flex flex-col gap-8"},z={class:"flex flex-col gap-4"},G={class:"flex gap-2 items-center"},J=s("span",null,"Telegram",-1),K={class:"flex flex-col gap-2"},O={class:"flex flex-col gap-4"},P={class:"flex gap-2 items-center"},Q=s("span",null,"Email",-1);function W(t,e,u,k,N,$){const l=d("ui-switcher"),r=d("telegram-bot"),T=d("ui-expand"),o=d("ui-button-loading");return i(),a("div",q,[s("div",A,n(t.$t("Receiving Notifications Method")),1),s("div",M,[s("div",z,[s("div",G,[c(l,{checked:t.checked(1),onSwitched:e[0]||(e[0]=f=>t.switchHandler(1))},null,8,["checked"]),J]),t.isTgBotSubscribed?U("",!0):(i(),m(T,{key:0,"is-expanded":t.checked(1)},{default:x(()=>[s("div",K,[s("div",null,n(t.$t("Subscribe to the telegram bot first")),1),c(r)])]),_:1},8,["is-expanded"]))]),s("div",O,[s("div",P,[c(l,{checked:t.checked(2),onSwitched:e[1]||(e[1]=f=>t.switchHandler(2))},null,8,["checked"]),Q])]),c(o,{class:"button button-primary py-2 px-4 self-start",type:"submit",loading:t.buttonLoading,onClick:t.saveTargets},{default:x(()=>[L(n(t.$t("Save")),1)]),_:1},8,["loading","onClick"])])])}const X=v(j,[["render",W]]),Y=b({components:{UiButtonLoading:w,UiCheckbox:B,UiSkeletonBox:C},data(){return{skeletonLoading:!1,system:[],events:[],reports:[],buttonLoading:!1}},computed:{...y("notifications",{allNotifications:"allNotifications",userNotifications:"userNotifications",isNotificationsLoaded:"isNotificationsLoaded",notificationsLoadTrigger:"notificationsLoadTrigger"})},watch:{notificationsLoadTrigger(){this.setNotifications()}},created(){this.loadNotificationsData(),this.setNotifications()},methods:{..._("notifications",["loadNotifications","enableTelegramNotifications","saveUserNotifications"]),async loadNotificationsData(){try{this.isNotificationsLoaded||(this.skeletonLoading=!0),await this.loadNotifications(),this.skeletonLoading=!1}catch{this.skeletonLoading=!1}},setNotifications(){this.isNotificationsLoaded&&(this.system=this.allNotifications.system.map(t=>({title:t.name,value:t.id,checked:!0})),this.events=this.allNotifications.events.map(t=>({title:t.name,value:t.id,checked:!!this.userNotifications.events.find(e=>e.id===t.id)})),this.reports=this.allNotifications.reports.map(t=>({title:t.name,value:t.id,checked:!!this.userNotifications.reports.find(e=>e.id===t.id)})))},async saveHandler(){try{this.buttonLoading=!0;const t=[...this.system,...this.events,...this.reports].filter(e=>e.checked).map(e=>e.value);await this.saveUserNotifications({notifications:t}),this.buttonLoading=!1,this.$toast.success(this.$t("Notifications types saved"))}catch{this.buttonLoading=!1}}}}),Z={class:"card common-wrapper"},tt={class:"text-xl mb-6"},et={class:"flex flex-col gap-8"},st={class:"flex flex-col gap-4"},it={class:"card-title"},ot={key:0,class:"flex flex-col gap-4"},at={key:1,class:"flex flex-col gap-4"},nt={class:"flex flex-col gap-4"},lt={class:"card-title"},ct={key:0,class:"flex flex-col gap-4"},dt={key:1,class:"flex flex-col gap-4"},rt={class:"flex flex-col gap-4"},ft={class:"card-title"},ut={key:0,class:"flex flex-col gap-4"},ht={key:1,class:"flex flex-col gap-4"};function gt(t,e,u,k,N,$){const l=d("ui-skeleton-box"),r=d("ui-checkbox"),T=d("ui-button-loading");return i(),a("div",Z,[s("div",tt,n(t.$t("Notifications Types")),1),s("div",et,[s("div",st,[s("div",it,n(t.$t("Systems"))+" ("+n(t.$t("Cannot be disabled"))+") ",1),t.skeletonLoading?(i(),a("div",ot,[(i(),a(h,null,g(2,o=>c(l,{key:o,width:"100%",height:"21px"})),64))])):(i(),a("div",at,[(i(!0),a(h,null,g(t.system,(o,f)=>(i(),m(r,{class:"self-start",key:f,label:o.title,modelValue:o.checked,"onUpdate:modelValue":p=>o.checked=p,disabled:""},null,8,["label","modelValue","onUpdate:modelValue"]))),128))]))]),s("div",nt,[s("div",lt,n(t.$t("Events")),1),t.skeletonLoading?(i(),a("div",ct,[(i(),a(h,null,g(5,o=>c(l,{key:o,width:"100%",height:"21px"})),64))])):(i(),a("div",dt,[(i(!0),a(h,null,g(t.events,(o,f)=>(i(),m(r,{class:"self-start",key:f,label:o.title,modelValue:o.checked,"onUpdate:modelValue":p=>o.checked=p},null,8,["label","modelValue","onUpdate:modelValue"]))),128))]))]),s("div",rt,[s("div",ft,n(t.$t("Reports")),1),t.skeletonLoading?(i(),a("div",ut,[(i(),a(h,null,g(3,o=>c(l,{key:o,width:"100%",height:"21px"})),64))])):(i(),a("div",ht,[(i(!0),a(h,null,g(t.reports,(o,f)=>(i(),m(r,{class:"self-start",key:f,label:o.title,modelValue:o.checked,"onUpdate:modelValue":p=>o.checked=p},null,8,["label","modelValue","onUpdate:modelValue"]))),128))]))]),c(T,{class:"button button-primary py-2 px-4 self-start",type:"submit",loading:t.buttonLoading,onClick:t.saveHandler},{default:x(()=>[L(n(t.$t("Save")),1)]),_:1},8,["loading","onClick"])])])}const pt=v(Y,[["render",gt]]),mt=b({components:{NotificationsTargets:X,NotificationsTypes:pt}}),_t={class:"page-title mb-6"},bt={class:"flex flex-col gap-6"};function vt(t,e,u,k,N,$){const l=d("notifications-targets"),r=d("notifications-types");return i(),a("div",null,[s("div",_t,n(t.$t("Notifications")),1),s("div",bt,[c(l),c(r)])])}const Lt=v(mt,[["render",vt]]);export{Lt as default};
