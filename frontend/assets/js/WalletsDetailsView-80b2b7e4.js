import{d as C,_ as k,o as i,c as o,a as d,n as B,t as r,i as b,p as E,b as A,r as c,h as _,e as p,w as m,j as y,f as $,k as U,F as S,q as D}from"./flag-icons.min-86ec5348.js";import{U as v}from"./UiSelect-ea4bca5c.js";import{U as V}from"./UiInput-de72e1ee.js";import{U as L}from"./UiTable-55d04511.js";import{U as I}from"./UiCopyToClipboard-54d0ebb6.js";import{U as N}from"./UiButtonLoading-8a0e711d.js";import{U as O}from"./UiSkeletonBox-7e5f2b59.js";import"./UiPagination-4e2c3226.js";import"./UiLoading-237702fa.js";const T=C({props:{id:{type:String},modelValue:{type:Boolean},label:{type:String},disabled:{type:Boolean,default:!1}},emits:["switched","update:modelValue"],methods:{checkboxHandler(e){const a=e.target.checked;this.$emit("update:modelValue",a),this.$emit("switched")}}});const F=e=>(E("data-v-d160e969"),e=e(),A(),e),H={class:"swither-wrapper"},P={class:"switcher"},M=["id","checked","disabled"],j=F(()=>d("span",{class:"switcher-span"},null,-1)),z=["for"];function q(e,a,l,n,w,g){return i(),o("div",H,[d("div",P,[d("input",{type:"checkbox",id:e.id,checked:e.modelValue,disabled:e.disabled,class:B(["switcher-checkbox",{"switcher-checkbox-checked":e.modelValue}]),onInput:a[0]||(a[0]=(...h)=>e.checkboxHandler&&e.checkboxHandler(...h))},null,42,M),j]),e.label?(i(),o("label",{key:0,for:e.id,class:"ml-4"},r(e.label),9,z)):b("",!0)])}const R=k(T,[["render",q],["__scopeId","data-v-d160e969"]]),G=C({components:{UiSelect:v,UiInput:V,UiTable:L,UiCopyToClipboard:I,UiSwitcher2:R},props:{index:{type:Number},title:{type:String},enabledWithdrawal:{type:Boolean},enabledExchange:{type:Boolean},depositWalletsSelected:{type:String},minBalance:{type:[Number,String]},withdrawalWalletsSelected:{type:String},depositWalletsOptions:{type:Array},withdrawalWalletsOptions:{type:Array},withdrawalWallets:{type:Array},exchangeDirection:{type:Array},checkWithdrawalAddresses:{type:Boolean},checkExchangeDirection:{type:Boolean}},emits:["update:enabledExchange","update:enabledWithdrawal","update:depositWalletsSelected","update:minBalance","update:withdrawalWalletsSelected","deleteWithdrawalWallet","addWithdrawalWallet"],data(){return{tableColumns:[{label:"Address",field:"address",textAlign:"text-left"},{label:"Chain",field:"chain",textAlign:"text-center"},{label:"Actions",field:"actions",textAlign:"text-right"}]}},computed:{enabledWithdrawalComp:{get(){return this.automaticWithdrawalDisabled?!this.automaticWithdrawalDisabled:this.enabledWithdrawal},set(e){this.$emit("update:enabledWithdrawal",e)}},enabledExchangeComp:{get(){return this.enabledExchange},set(e){this.$emit("update:enabledExchange",e)}},depositWalletsSelectedComp:{get(){return this.depositWalletsSelected},set(e){this.$emit("update:depositWalletsSelected",e)}},minBalanceComp:{get(){return this.minBalance},set(e){this.$emit("update:minBalance",e)}},withdrawalWalletsSelectedComp:{get(){return this.withdrawalWalletsSelected},set(e){this.$emit("update:withdrawalWalletsSelected",e)}},automaticWithdrawalDisabled(){var e;return!((e=this.withdrawalWallets)!=null&&e.length&&(this.checkWithdrawalAddresses||!this.checkExchangeDirection))}},methods:{deleteWithdrawalWallet(e){this.$emit("deleteWithdrawalWallet",{address:e,index:this.index})},addWithdrawalWalletHandler(e){this.$emit("addWithdrawalWallet",{address:e,index:this.index})}}}),J={class:"card"},K={class:"card-title mb-6"},Q={class:"flex flex-col gap-6"},X={key:1,class:"flex items-center gap-2"},Y={class:"font-600"},Z={class:"uppercase font-600 bg-gray-200 px-8px py-2px"},ee={class:"flex flex-col gap-2"},ae={for:"depositWallets",class:"self-start"},te={class:"flex items-end gap-2"},le=d("span",{class:"mb-9px font-600"},"USD",-1),se={key:2,class:"flex flex-col gap-6"},de={key:0,class:"flex flex-col gap-6"},ne={class:"flex flex-col gap-2"},ie={for:"withdrawalWallets",class:"self-start"},oe={class:"flex items-center gap-2"},re={class:"flex justify-end"},ce=["onClick"],he={key:1,class:"text-red-500"};function pe(e,a,l,n,w,g){const h=c("ui-switcher2"),u=c("ui-select"),W=c("ui-input"),x=c("ui-copy-to-clipboard"),s=c("feather-icon"),f=c("ui-table");return i(),o("div",J,[d("div",K,r(e.title),1),d("div",Q,[e.checkExchangeDirection?(i(),_(h,{key:0,class:"self-start",label:e.$t("Enable automatic exchange"),modelValue:e.enabledExchangeComp,"onUpdate:modelValue":a[0]||(a[0]=t=>e.enabledExchangeComp=t)},null,8,["label","modelValue"])):b("",!0),e.exchangeDirection.length?(i(),o("div",X,[d("span",Y,r(e.$t("Exchange Direction"))+": ",1),d("span",Z,r(`${e.exchangeDirection[0].currencyFrom} / ${e.exchangeDirection[0].currencyTo}`),1)])):b("",!0),d("div",ee,[d("label",ae,r(e.$t("Deposit wallet")),1),p(u,{id:"depositWallets",class:"h-40px",placeholder:`${e.$t("Select wallet")}...`,modelValue:e.depositWalletsSelectedComp,"onUpdate:modelValue":a[1]||(a[1]=t=>e.depositWalletsSelectedComp=t),options:e.depositWalletsOptions},null,8,["placeholder","modelValue","options"])]),d("div",te,[p(W,{class:"max-w-200px",type:"number",id:"minBalance",modelValue:e.minBalanceComp,"onUpdate:modelValue":a[2]||(a[2]=t=>e.minBalanceComp=t),label:e.$t("Min Balance")},null,8,["modelValue","label"]),le]),e.withdrawalWalletsOptions.length||e.checkExchangeDirection?(i(),o("div",se,[p(h,{class:"self-start",label:e.$t("Enable automatic withdrawals"),modelValue:e.enabledWithdrawalComp,"onUpdate:modelValue":a[3]||(a[3]=t=>e.enabledWithdrawalComp=t),disabled:e.automaticWithdrawalDisabled},null,8,["label","modelValue","disabled"]),e.checkWithdrawalAddresses||!e.checkExchangeDirection?(i(),o("div",de,[d("div",ne,[d("label",ie,r(e.$t("Withdrawal wallets")),1),p(u,{id:"withdrawalWallets",class:"h-40px",placeholder:`${e.$t("Select wallet")}...`,modelValue:e.withdrawalWalletsSelectedComp,"onUpdate:modelValue":a[4]||(a[4]=t=>e.withdrawalWalletsSelectedComp=t),options:e.withdrawalWalletsOptions,onChange:e.addWithdrawalWalletHandler},null,8,["placeholder","modelValue","options","onChange"])]),e.withdrawalWallets.length?(i(),_(f,{key:0,columns:e.tableColumns,data:e.withdrawalWallets},{"cell-address":m(({row:t})=>[d("div",oe,[d("span",null,r(`${t.address.slice(0,7)}...${t.address.slice(-5)}`),1),p(x,{"text-to-copy":t.address},null,8,["text-to-copy"])])]),"cell-chain":m(({row:t})=>[y(r(t.chain.toUpperCase()),1)]),"cell-actions":m(({row:t})=>[d("div",re,[d("button",{class:"button button-error flex items-center px-2 h-32px",onClick:fe=>e.deleteWithdrawalWallet(t.address)},[p(s,{type:"trash-2",size:"18"})],8,ce)])]),_:1},8,["columns","data"])):b("",!0)])):(i(),o("div",he,r(e.$t("automatic_withdrawal_is_not_available_text")),1))])):b("",!0)])])}const we=k(G,[["render",pe]]),ue=C({components:{WalletCard:we,UiButtonLoading:N,UiSkeletonBox:O},data(){return{walletsData:[],buttonLoading:!1,skeletonLoading:!0}},computed:{...$("wallets",{wallets:"wallets"}),...$("exchanges",{depositWallets:"depositWallets",withdrawalWallets:"withdrawalWallets"}),exchangeName(){return this.$route.params.exchange_name},depositWalletsOptions(){return e=>this.depositWallets.reduce((a,l)=>(l.chain===e&&a.push({title:`${l.address} (${l.chain.toUpperCase()})`,value:l.address}),a),[])},withdrawalWalletsOptions(){return(e,a)=>this.withdrawalWallets.filter(l=>{var n;return l.currency===((n=a[0])==null?void 0:n.currencyTo)}).reduce((l,n)=>(e.find(w=>w.address===n.address)||l.push({title:`${n.address} (${n.chain.toUpperCase()})`,value:n.address}),l),[])}},created(){this.loadData()},methods:{...U("wallets",["loadAndCreateWallets"]),...U("exchanges",["loadWallets","updateExchangeSettings"]),async loadData(){try{await Promise.all([this.loadAndCreateWallets(),this.loadWallets({exchange:this.exchangeName})]),this.setData(),this.skeletonLoading=!1,this.$store.commit("app/setProgressBar","stop")}catch{this.$store.commit("app/setProgressBar","stop"),this.skeletonLoading=!1}},setData(){this.walletsData=this.wallets.map(e=>{var l,n,w,g,h,u;const a=this.checkWithdrawalAddresses(e.exchangeCurrenciesUserList);return{id:e.id,chain:e.chain,blockchain:e.blockchain,enabledWithdrawal:(l=e.exchangeColdWalletAddresses)!=null&&l.length?e.exchangeColdWalletAddresses.every(W=>W.isWithdrawalEnabled):!1,enabledExchange:(n=e.exchangeCurrenciesUserList)!=null&&n.length?e.enableAutomaticExchange===1:!1,depositWalletsSelected:this.checkDepositWallets(e.address)?e.address:"",minBalance:(w=e.exchangeColdWalletAddresses)!=null&&w.length?e.exchangeColdWalletAddresses[0].withdrawalMinBalance:0,exchange:this.exchangeName,exchangeCurrenciesFrom:(g=e.exchangeCurrencies)!=null&&g.fromCurrencyId?e.exchangeCurrencies.fromCurrencyId:"",exchangeCurrenciesTo:(h=e.exchangeCurrencies)!=null&&h.toCurrencyId?e.exchangeCurrencies.toCurrencyId:"",withdrawalWallets:e.exchangeColdWalletAddresses,exchangeCurrenciesUserList:e.exchangeCurrenciesUserList,checkWithdrawalAddresses:a,checkExchangeDirection:!!((u=e.exchangeCurrenciesUserList)!=null&&u.length)}})},checkDepositWallets(e){return this.depositWallets.find(a=>a.address===e)},checkWithdrawalAddresses(e){return!!(e!=null&&e.length&&this.withdrawalWallets.filter(l=>l.currency===e[0].currencyTo).length)},addWithdrawalWallet(e){const a=this.withdrawalWallets.find(l=>l.address===e.address);this.walletsData[e.index].withdrawalWallets.push({address:a.address,isWithdrawalEnabled:!1,chain:a.chain,withdrawalMinBalance:""}),this.walletsData[e.index].withdrawalWalletsSelected=""},deleteWithdrawalWallet(e){this.walletsData[e.index].withdrawalWallets=this.walletsData[e.index].withdrawalWallets.filter(a=>a.address!==e.address)},async finishHandler(){try{this.buttonLoading=!0,await Promise.all(this.walletsData.map(e=>{var a,l;return e.depositWalletsSelected?this.updateExchangeSettings({walletId:e.id,payload:{withdrawalEnabled:!0,address:e.depositWalletsSelected,enableAutomaticExchange:e.enabledExchange,exchange:this.exchangeName,exchangeCurrenciesFrom:(a=e.exchangeCurrenciesUserList)!=null&&a.length?e.exchangeCurrenciesUserList[0].currencyFrom:null,exchangeCurrenciesTo:(l=e.exchangeCurrenciesUserList)!=null&&l.length?e.exchangeCurrenciesUserList[0].currencyTo:null,exchangeColdWalletAddress:this.withdrawalWalletsOptions(e.withdrawalWallets,e.exchangeCurrenciesUserList).length?e.withdrawalWallets.map(n=>({...n,withdrawalMinBalance:Number(e.minBalance),isWithdrawalEnabled:e.enabledWithdrawal})):[]}}):Promise.resolve()})),await this.loadData(),this.buttonLoading=!1,this.$toast.success(this.$t("Settings successfully updated"))}catch{this.buttonLoading=!1}}}});const ge={key:0,class:"grid gap-6 grid-cols-[1fr,1fr] mb-6"},We={key:1,class:"wallet-card-wrapper"},be={class:"flex items-center gap-4 justify-between"};function me(e,a,l,n,w,g){const h=c("ui-skeleton-box"),u=c("wallet-card"),W=c("router-link"),x=c("ui-button-loading");return i(),o("div",null,[e.skeletonLoading?(i(),o("div",ge,[(i(),o(S,null,D(2,s=>p(h,{key:s,width:"100%",height:"346px"})),64))])):(i(),o("div",We,[(i(!0),o(S,null,D(e.walletsData,(s,f)=>(i(),_(u,{key:f,index:f,title:s.blockchain,"exchange-direction":s.exchangeCurrenciesUserList,"enabled-withdrawal":s.enabledWithdrawal,"onUpdate:enabled-withdrawal":t=>s.enabledWithdrawal=t,"enabled-exchange":s.enabledExchange,"onUpdate:enabled-exchange":t=>s.enabledExchange=t,"deposit-wallets-selected":s.depositWalletsSelected,"onUpdate:deposit-wallets-selected":t=>s.depositWalletsSelected=t,"min-balance":s.minBalance,"onUpdate:min-balance":t=>s.minBalance=t,"withdrawal-wallets-selected":s.withdrawalWalletsSelected,"onUpdate:withdrawal-wallets-selected":t=>s.withdrawalWalletsSelected=t,"deposit-wallets-options":e.depositWalletsOptions(s.chain),"withdrawal-wallets-options":e.withdrawalWalletsOptions(s.withdrawalWallets,s.exchangeCurrenciesUserList),"withdrawal-wallets":s.withdrawalWallets,"check-withdrawal-addresses":s.checkWithdrawalAddresses,"check-exchange-direction":s.checkExchangeDirection,onDeleteWithdrawalWallet:e.deleteWithdrawalWallet,onAddWithdrawalWallet:e.addWithdrawalWallet},null,8,["index","title","exchange-direction","enabled-withdrawal","onUpdate:enabled-withdrawal","enabled-exchange","onUpdate:enabled-exchange","deposit-wallets-selected","onUpdate:deposit-wallets-selected","min-balance","onUpdate:min-balance","withdrawal-wallets-selected","onUpdate:withdrawal-wallets-selected","deposit-wallets-options","withdrawal-wallets-options","withdrawal-wallets","check-withdrawal-addresses","check-exchange-direction","onDeleteWithdrawalWallet","onAddWithdrawalWallet"]))),128))])),d("div",be,[p(W,{class:"button button-primary px-4 py-2",to:{name:"withdrawals-exchange-2",params:{exchange_name:e.exchangeName}}},{default:m(()=>[y(r(e.$t("Return")),1)]),_:1},8,["to"]),p(x,{class:"button button-primary px-4 py-2",loading:e.buttonLoading,disabled:e.skeletonLoading,onClick:e.finishHandler},{default:m(()=>[y(r(e.$t("Finish")),1)]),_:1},8,["loading","disabled","onClick"])])])}const Be=k(ue,[["render",me],["__scopeId","data-v-77bd1bac"]]);export{Be as default};
