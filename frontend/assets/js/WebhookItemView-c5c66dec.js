import{d as v,f as u,k as g,_,r as i,o as l,c as d,a as s,t as n,e as r,F as U,q as $,i as p,h as b,w as V,l as I}from"./flag-icons.min-86ec5348.js";import{U as W}from"./UiSwitcher-bf0903c2.js";import{U as S}from"./UiCheckbox-fa9f1ce9.js";import{U as L}from"./UiButtonLoading-8a0e711d.js";import{U as B}from"./UiInput-de72e1ee.js";const F=v({components:{UiSwitcher:W,UiCheckbox:S,UiButtonLoading:L,UiInput:B},data(){return{webhookId:"",payloadUrl:"",secretBase:"",enabled:!0,eventsSelected:[],buttonLoading:!1}},computed:{storeIdFromUrl(){return this.$route.params.store_id},...u("dictionaries",{webhookTypes:"webhookTypes"}),...u("stores",["webhookList"])},watch:{webhookList(){this.syncDataFromVuex()},webhookTypes(){this.syncDataFromVuex()}},created(){this.loadWebhooksData(),this.syncDataFromVuex()},methods:{switchEnabledHandler(){this.enabled=!this.enabled},loadWebhooksData(){this.$route.params.webhook_id!=="new"&&this.loadWebhooks(this.storeIdFromUrl)},async updateWebhookHandler(){const e=this.eventsSelected.filter(t=>t.checked).map(t=>t.value);if(this.webhookId==="new")try{this.buttonLoading=!0,await this.createWebhook({storeId:this.storeIdFromUrl,payload:{url:this.payloadUrl,secret:this.secretBase,enabled:this.enabled,events:e}}),this.buttonLoading=!1,this.$router.push({name:"store-settings-advanced"}),this.$toast.success(this.$t("Webhook successfully created"))}catch{this.buttonLoading=!1}else try{this.buttonLoading=!0,await this.updateWebhook({storeId:this.storeIdFromUrl,webhookId:this.webhookId,payload:{url:this.payloadUrl,secret:this.secretBase,enabled:this.enabled,events:e}}),this.buttonLoading=!1,this.$toast.success(this.$t("Webhook successfully updated"))}catch{this.buttonLoading=!1}},async syncDataFromVuex(){const e=this.$route.params.webhook_id;if(this.webhookId=e,e==="new")this.payloadUrl="",this.secretBase=await this.generateSecret(),this.enabled=!0,this.eventsSelected=this.webhookTypes.map((t,a)=>({title:t.title,value:t.value,checked:a===0}));else{const t=this.webhookList.filter(a=>a.id===e);t.length&&(this.payloadUrl=t[0].url,this.secretBase=t[0].secret,this.enabled=!!t[0].enabled,this.eventsSelected=this.webhookTypes.map(a=>({title:a.title,value:a.value,checked:!!t[0].events.find(h=>h===a.value)})))}},...g("stores",["loadWebhooks","generateSecret","createWebhook","updateWebhook"])}});const D={class:"card common-wrapper"},E={class:"text-2xl mb-6"},T={class:"form-inputs"},C={class:"flex items-center gap-4"},H={class:"text-2xl mb-6"},q={class:"flex flex-col gap-4"},x={key:0,class:"flex flex-col gap-4"},A={key:0},N={key:1};function P(e,t,a,h,M,R){const c=i("ui-input"),k=i("ui-switcher"),m=i("ui-checkbox"),w=i("ui-button-loading");return l(),d("div",D,[s("div",E,n(e.$t("Webhook Settings")),1),s("form",{class:"form",onSubmit:t[2]||(t[2]=I((...o)=>e.updateWebhookHandler&&e.updateWebhookHandler(...o),["prevent"]))},[s("div",T,[r(c,{required:"","label-required-mark":"on",modelValue:e.payloadUrl,"onUpdate:modelValue":t[0]||(t[0]=o=>e.payloadUrl=o),type:"url",id:"payloadUrl",label:e.$t("Payload URL"),pattern:"https?://.+","pattern-vatidate-text":e.$t("Please match the url format")},null,8,["modelValue","label","pattern-vatidate-text"]),r(c,{disabled:"",modelValue:e.secretBase,"onUpdate:modelValue":t[1]||(t[1]=o=>e.secretBase=o),type:"text",id:"secretBase",label:e.$t("Secret")},null,8,["modelValue","label"])]),s("div",C,[r(k,{checked:e.enabled,onSwitched:e.switchEnabledHandler},null,8,["checked","onSwitched"]),s("span",null,n(e.$t("Enabled")),1)]),s("div",null,[s("div",H,n(e.$t("Events")),1),s("div",q,[s("div",null,n(e.$t("Which events would you like to trigger this webhook?")),1),e.webhookTypes.length?(l(),d("div",x,[(l(!0),d(U,null,$(e.eventsSelected,(o,y)=>(l(),b(m,{class:"self-start",key:y,id:o.value,label:o.title,modelValue:o.checked,"onUpdate:modelValue":f=>o.checked=f},null,8,["id","label","modelValue","onUpdate:modelValue"]))),128))])):p("",!0)])]),e.webhookId?(l(),b(w,{key:0,loading:e.buttonLoading,class:"button button-primary px-4 py-2 self-start"},{default:V(()=>[e.webhookId==="new"?(l(),d("span",A,n(e.$t("Add webhook")),1)):(l(),d("span",N,n(e.$t("Update webhook")),1))]),_:1},8,["loading"])):p("",!0)],32)])}const O=_(F,[["render",P],["__scopeId","data-v-2b72e0cc"]]);export{O as default};
